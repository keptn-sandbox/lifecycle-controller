apiVersion: v1
kind: ConfigMap
metadata:
  name: kube-burner-config
  namespace: keptn-lifecycle-toolkit-system
data:
  config.yml: |
    ---
    global:
      writeToFile: true
      metricsDirectory: collected-metrics
      prometheusURL: http://prometheus-k8s.monitoring:9090

    jobs:
      - name: keptn-apps
        jobIterations: 1
        qps: 4
        burst: 4
        namespacedIterations: true
        namespace: keptn-apps
        podWait: false
        cleanup: true
        waitFor: []
        waitWhenFinished: true
        preLoadImages: false
        objects:
          - objectTemplate: /config/templates.yaml
            replicas: 100
  metric-profile.yml: |
    - query: container_memory_usage_bytes{container="manager", namespace="keptn-lifecycle-toolkit-system"}
      metricName: MemoryUsage

    - query: rate(container_cpu_usage_seconds_total{container="manager", namespace="keptn-lifecycle-toolkit-system"}[1m])
      metricName: CPUUsage

    - query: sum by(job) (rate(apiserver_request_total{job="apiserver"}[1m]))
      metricName: APIServerRequests
  templates.yaml: |-
    apiVersion: metrics.keptn.sh/v1alpha1
    kind: KeptnMetric
    metadata:
      name: keptnmetric-load-test
      namespace: keptn-lifecycle-toolkit-system
    spec:
      provider:
        name: "prometheus-load-test-provider"
      query: "sum(kube_pod_container_resource_limits{resource='cpu'})"
      fetchIntervalSeconds: 10
